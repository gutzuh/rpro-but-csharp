<Window x:Class="RPRO.App.Views.LoginView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Cortez - Login"
        Height="500" Width="400"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        MouseDown="Window_MouseDown">

    <Border Background="White" CornerRadius="16" 
            BorderBrush="#E0E0E0" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.3"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header com Logo -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource MaterialDesign.Brush.Primary}"
                    CornerRadius="16,16,0,0"
                    Padding="32">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Cortez" 
                               FontSize="28" 
                               FontWeight="Bold" 
                               Foreground="White"
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="Sistema de Produção" 
                               FontSize="12" 
                               Foreground="#CCFFFFFF"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Botão Fechar -->
            <Button Grid.Row="0"
                    Command="{Binding ExitAppCommand}"
                    Style="{StaticResource MaterialDesignIconButton}"
                    Foreground="White"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="8">
                <materialDesign:PackIcon Kind="Close"/>
            </Button>

            <!-- Formulário -->
            <StackPanel Grid.Row="1" Margin="32" VerticalAlignment="Center">
                
                <!-- Debug Info -->
                <TextBlock Text="{Binding Username, StringFormat='User: {0}'}"
                           Foreground="Gray"
                           FontSize="10"
                           Margin="0,0,0,8"/>
                
                <!-- Erro -->
                <Border Background="#FFEBEE" 
                        CornerRadius="4" 
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AlertCircle" Foreground="#E53935" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ErrorMessage}" 
                                   Foreground="#C62828" 
                                   Margin="8,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Username -->
                <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                         materialDesign:HintAssist.Hint="Usuário"
                         materialDesign:TextFieldAssist.HasLeadingIcon="True"
                         materialDesign:TextFieldAssist.LeadingIcon="Account"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         FontSize="14"
                         Margin="0,0,0,16">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Return" Command="{Binding LoginCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>

                <!-- Password -->
                <PasswordBox x:Name="PasswordBox"
                             materialDesign:HintAssist.Hint="Senha"
                             materialDesign:TextFieldAssist.HasLeadingIcon="True"
                             materialDesign:TextFieldAssist.LeadingIcon="Lock"
                             Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                             FontSize="14"
                             Margin="0,0,0,16"
                             PasswordChanged="PasswordBox_PasswordChanged">
                    <PasswordBox.InputBindings>
                        <KeyBinding Key="Return" Command="{Binding LoginCommand}"/>
                    </PasswordBox.InputBindings>
                </PasswordBox>

                <!-- Lembrar usuário -->
                <CheckBox Content="Lembrar usuário"
                          IsChecked="{Binding LembrarUsuario}"
                          Margin="0,0,0,24"/>

                <!-- Botão Login -->
                <Button Command="{Binding LoginCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Height="45"
                        FontSize="14"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InvertBoolConverter}}">
                    <Grid>
                        <TextBlock Text="ENTRAR" 
                                   Visibility="{Binding IsLoading, Converter={StaticResource InvertBoolConverter}, ConverterParameter=Visibility}"/>
                        <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                     IsIndeterminate="True"
                                     Width="24" Height="24"
                                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </Grid>
                </Button>

            </StackPanel>

            <!-- Footer -->
            <TextBlock Grid.Row="2" 
                       Text="© 2024 J.Cortica - v2.0.0"
                       Foreground="Gray"
                       FontSize="10"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,16"/>
        </Grid>
    </Border>
</Window>